<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ziddi Shortener</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

    <style>
        :root { --bg: #0d0f14; --neon: #00ff41; --panel: #161b22; }
        body { background: var(--bg); color: #fff; font-family: 'Courier New', monospace; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        
        .container { 
            background: var(--panel); padding: 25px; border-radius: 20px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); width: 100%; max-width: 400px; 
            border: 1px solid #30363d; text-align: center; margin-top: 30px;
        }

        h1 { color: var(--neon); font-size: 1.5rem; text-transform: uppercase; margin-bottom: 20px; }
        
        .input-box { 
            width: 100%; padding: 14px; margin: 10px 0; background: #000; 
            border: 1px solid #333; border-radius: 10px; color: var(--neon); 
            outline: none; box-sizing: border-box; font-size: 14px;
        }

        .watch-btn {
            background: #1f242d; color: #888; border: 1px solid #333;
            padding: 8px 15px; border-radius: 5px; cursor: pointer;
            font-size: 12px; margin-bottom: 10px; transition: 0.3s;
        }
        .watch-btn:hover { border-color: var(--neon); color: var(--neon); }

        .btn-gen { 
            width: 100%; padding: 15px; margin-top: 10px; border-radius: 10px; 
            background: var(--neon); color: #000; font-weight: 900; border: none; cursor: pointer; 
        }

        #result-panel { 
            margin-top: 25px; display: none; background: #080a0e; padding: 15px; 
            border-radius: 12px; border: 1px dashed var(--neon);
        }

        .url-display { font-size: 13px; color: #fff; word-break: break-all; display: block; margin-bottom: 15px; }
    </style>
</head>
<body>

    <div class="container">
        <h1>Ziddi Shortener</h1>
        
        <input type="url" id="longUrl" class="input-box" placeholder="Paste Your Main Link">
        
        <button class="watch-btn" onclick="document.getElementById('customName').value='WatchNow'">+ Add WatchNow</button>
        
        <input type="text" id="customName" class="input-box" placeholder="Custom Name (Optional)">
        
        <button class="btn-gen" id="mainBtn" onclick="createShortLink()">Shorten Now</button>

        <div id="result-panel">
            <span class="url-display" id="shortUrlOutput"></span>
            <button class="btn-gen" style="background:#fff;" onclick="copyLink()">COPY LINK</button>
        </div>
    </div>

    <script>
        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyCFy28nNtxhkjfpOd0aCfYkjHUwErh1WVQ",
            authDomain: "movie-1e6fc.firebaseapp.com",
            projectId: "movie-1e6fc",
            databaseURL: "https://movie-1e6fc-default-rtdb.firebaseio.com",
            storageBucket: "movie-1e6fc.firebasestorage.app",
            messagingSenderId: "371616954594",
            appId: "1:371616954594:web:977d88ec7570df351246bb"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        async function createShortLink() {
            const longUrl = document.getElementById('longUrl').value;
            const custom = document.getElementById('customName').value.trim();
            if (!longUrl) return alert("Link paste karein!");

            const id = custom ? custom : Math.random().toString(36).substring(2, 7);
            
            try {
                await db.ref('links/' + id).set({ original: longUrl });

                // Yahan hum fake link nahi balkay real URL banayenge
                // Agar aap GitHub par upload karenge toh ye khud theek ho jayegi
                let currentUrl = window.location.href.split('?')[0];
                if(currentUrl.startsWith("file:///")) {
                    currentUrl = "ziddihacks.com/"; // Prank/Showcase ke liye agar file mode mein ho
                }
                
                document.getElementById('shortUrlOutput').innerText = currentUrl + "?id=" + id;
                document.getElementById('result-panel').style.display = 'block';
            } catch (e) { alert("Firebase Rules check karein!"); }
        }

        function copyLink() {
            const link = document.getElementById('shortUrlOutput').innerText;
            navigator.clipboard.writeText(link).then(() => alert("Copied!"));
        }

        // Redirection Logic
        const params = new URLSearchParams(window.location.search);
        if (params.get('id')) {
            const id = params.get('id');
            db.ref('links/' + id).once('value').then(snap => {
                if (snap.exists()) window.location.replace(snap.val().original);
            });
        }
    </script>
</body>
</html>
